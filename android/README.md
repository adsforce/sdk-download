# Adsforce Android SDK Integration Documentation
---


## Including the SDK
Firstly, Download `AdsforceSdk_xxx.aar` and `installreferrer_xxx.jar`, then include them into `libs` directory in your project.

> File `installreferrer_xxx.jar` is Provided by Google, a reliable way to securely retrieve install referral content. 
Using this API, your app will get precise information straight from the Play Store

*	If you use `AndroidStudio` to build project，please add the following compile statement to your app-level build.gradle (not project!).

```groovy
repositories {
    flatDir {
        dirs 'libs'
    }
}

dependencies {
    compile(name: 'AdsforceSdk_xxx', ext: 'aar')
    compile(name: 'installreferrer_x.x.x', ext: 'jar')
    compile 'com.google.android.gms:play-services-base:15.0.1'
}
```

*	If using a development tool that doesn't support the `gradle`, but you can use the `aar` file, we've provided you with a play-services-base dependency library file, you can download the files and add them to your project.

*	If using a development tool that doesn't support to use the `aar` file, the `play-services-base` dependent library cannot be used in this case. Simply import the `installreferrer_xxx.jar` file, unzip the `AdsforceSdk_xxx.aar` ,then rename the `classes.jar` and import it into the project. Finally copy the following codes into  `AndroidManifest.xml` file of your project.

```xml
<uses-permission android:name="android.permission.INTERNET"/>
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/>
<uses-permission android:name="com.google.android.finsky.permission.BIND_GET_INSTALL_REFERRER_SERVICE" />
	
<receiver android:name="com.adsforce.sdk.install.receiver.AdsforceInstallReferrerReceiver"
 	android:exported="true">
	<intent-filter>
		<action android:name="com.android.vending.INSTALL_REFERRER"/>
	</intent-filter>
</receiver>
```


## Initialize the SDK

Please register your application on portal. After registrating, refer to the initialization code generated by the website and initialize `AdsforceSdk` in the`Application.onCreate()` .

**Sample code：**

```java
public class MyApplication extends Application {

    @Override
    public void onCreate() {
        super.onCreate();
        AdsforceSdk.initSdk(this, "<your_dev_key>","<your_public_key>", "https://<your_track_host>/", "<your_channel_id>");
	}
}
```


## About DeepLink

If you want to know the `deeplink` information , you can call the following code to get the user's `deeplink` information after initialization.

```java
AdsforceSdk.getDeepLink(getApplicationContext(), new AdsforceDeepLinkCallback() {
    @Override
    public void onFetchDeepLink(AdsforceDeepLink deepLink) {
        if (deepLink != null) {
            Log.i(TAG, "deeplink is " + deepLink.getTargetUri());
        } else {
            Log.i(TAG, "deeplink is null");
        }
    }
});
```


## About Google payment report

If the in-app purchase uses the `google payment`, you can call the following method to report this payment.

```java
/**
 * In-app purchase record(Google-certified)
 *
 * @param price          Payment amount, recommended to take from the 'price' field of skudetail, can not be empty
 * @param currency       Payment currency，Payment amount, recommended to take from the 'price_currency_code' field of skudetail, can not be empty
 * @param publicKey      Public key of Google payment，can not be empty
 * @param dataSignature  Signature verification from GP payment, get from Purchase.getSignature()，can not be empty
 * @param purchaseData   Signature verification from GP payment, get from Purchase.getOriginalJson()，can not be empty
 * @param params         Other params，can be empty
 */
AdsforceSdk.googleZFReportWithProductPrice(@NonNull String price, @NonNull String currency, @NonNull String publicKey, @NonNull String dataSignature, @NonNull String purchaseData, Map<String, String> params);
```

> Note: This method must be called after initializing the SDK.

## About Third-party payment report

If the in-app purchase uses the `third-party payment`, you can call the following method to report this payment.

```java
/**
 * In-app purchase record(custom)
 *
 * @param price        Payment amount, recommended to take from the 'price' field of skudetail, can not be empty
 * @param currency     Payment currency，Payment amount, recommended to take from the 'price_currency_code' field of skudetail, can not be empty
 * @param productId    Id of product，recommended to take from the 'productId' field of skudetail，can not be empty
 * @param productType  Type of product，recommended to take from the 'type' field of skudetail，can not be empty
 */
AdsforceSdk.thirdZFReportWithProductPrice(@NonNull String price, @NonNull String currency, String productId, String productType);
```

> Note: This method must be called after initializing the SDK.

## Custom event report

You can report the custom events that occur in the application. 

If you want to report custom event, you should open the custom event report controller firstly.

> Note: Default custom event report controller is disable.

```java
AdsforceSdk.enableCustomerEvent(true);
```

Or maybe you don't need to reprot custom event, you can disable the custom reporter.

```java
AdsforceSdk.enableCustomerEvent(false);
```

Depending on the type of the reported parameters, you can select one of the following three methods for reporting.

```java
/**
 * Custom event report
 *
 * @param key   Key of event
 * @param value Data for reproting
 */
AdsforceSdk.customerEventWithValue(String key, String value);

/**
 * Custom event report
 *
 * @param key Key of event
 * @param map Use HashMap for reproting
 */
AdsforceSdk.customerEventWithMap(String key, HashMap<String, String> map);

/**
 * Custom event report
 *
 * @param key  Key of event
 * @param list Use Arraylist for reproting
 */
AdsforceSdk.customerEventWithList(String key, ArrayList<String> list);
```

> Note: Please call this method must be called after initializing the SDK.

## Set AndroidId
In order to ensure the accuracy of the data , Please ensure that the privacy of the user will not be revealed and call the following method to pass the `AndroidId` to us.

```java
AdsforceSdk.setAndroidId(getApplicationContext(), getAndroidId());
```

> Note: Please call this method must be called before initializing the SDK.
